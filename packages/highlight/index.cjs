'use strict';

var e = require('chalk');
var cliHighlight = require('cli-highlight');

var r={keyword:e.hex("#cb3f6e"),built_in:e.hex("#81D4FA"),literal:e.hex("#F48FB1"),number:e.hex("#F48FB1"),string:e.hex("#FFF78C"),function:e.hex("#81D4FA"),title:e.whiteBright,params:e.hex("#FFAB40"),comment:e.hex("#888888"),meta:e.whiteBright,"meta-keyword":e.whiteBright,"meta-string":e.whiteBright,section:e.whiteBright,tag:e.hex("#BECAFF"),name:e.hex("#FF93BC"),"builtin-name":e.whiteBright,attr:e.hex("#91EBC2"),attribute:e.whiteBright,variable:e.whiteBright,bullet:e.whiteBright,code:e.whiteBright,emphasis:e.italic,strong:e.bold,formula:e.whiteBright,link:e.underline,quote:e.whiteBright,"selector-tag":e.whiteBright,"selector-id":e.whiteBright,"selector-class":e.whiteBright,"selector-attr":e.whiteBright,"selector-pseudo":e.whiteBright,"template-tag":e.blueBright,"template-variable":e.green};var g=t=>t.replace(/(\x9B|\x1B\[)[0-?]*[ -\\/]*[@-~]/g,""),a=t=>e.hex("#81D4FA")(t),l=t=>r.keyword(g(t)),m=t=>e.hex("#FF91E3")(t),p=t=>r.literal(g(t)),o=t=>r.string(g(t)),h=t=>e.hex("#5CD7E")(t),u=t=>r.comment(g(t)),w=t=>/\b(?:end)?comment/.test(t)?r.comment(t):r.keyword(t),B=t=>t==="{%-"?`${e.gray("{%")}${r.keyword("-")}`:t==="{{-"?`${e.gray("{{")}${r.keyword("-")}`:t==="-}}"?`${r.keyword("-")}${e.gray("}}")}`:t==="-%}"?`${r.keyword("-")}${e.gray("%}")}`:e.gray(t);function f(t){return t.replace(/\s*[a-zA-Z._]+/,w).replace(new RegExp("(?<=[|,])\\s*[a-zA-Z_]*(?=:?)","g"),h).replace(/[a-zA-Z_]+?\s*(?=[[.])/,a).replace(/[|,.:]/g,l).replace(/(?:=|[!=]=|[<>]=?|\b(?:and|or|contains|with|in|null|with|as)\b)/g,m).replace(/["'].*?["']/g,o)}function d(t){return t.replace(new RegExp("(?<=[|,])\\s*[a-zA-Z_]*(?=:?)","g"),h).replace(/[a-zA-Z_]+?\s*(?=[[.])/,a).replace(/[|,.:]/g,l).replace(/["'].*?["']/g,o)}var x=t=>t.replace(/{%-?\s*#\s*[\s\S]+%}/g,n=>(console.log(n),g(n)));function c(t){return t.replace(new RegExp("(?<={%-?)[\\s\\S]+?(?=-?%})","g"),f).replace(new RegExp("(?<={{-?)[\\s\\S]+?(?=-?}})","g"),d).replace(/\b(null|false|nil|true|empty)\b/g,p).replace(/{[{%]-?|-?[%}]}/g,B).replace(/{%-?\s*comment[\s\S]+endcomment\s*-?%}/g,u).replace(/{%-?\s*#\s*[\s\S]+%}/g,x)}function k(t,n={}){Object.assign(n,{theme:r,language:"html"});let s=cliHighlight.highlight(t,n);return n.language!=="html"?s:c(s)}

module.exports = k;
